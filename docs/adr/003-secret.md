# ADR002-clusters

## Status

Approved

## Decision Outcome

TACOKUMOでは､｢できるだけアプリケーションのコードを書き換えずに､TACOKUMOに移行できる｣ことを目指します｡
アプリケーションがDBの接続先やその他情報を環境変数として受け取る場合に､TACOKUMOがそれらの情報を提供できるようにします｡

例えば､あるアプリケーションが `DB_HOST` という環境変数を使ってDBの接続先を指定している場合に､
その実装を変更せずに､TACOKUMO側でアプリケーションにわたす環境変数とその値を設定できるようにします｡

アプリケーションに複数のStageがある場合は､異なる値を設定したくなることもある､
Stageごとに異なる値を設定できるようにします｡

### API

TACOKUMOのPortal APIで､シークレットを管理する機能を提供します｡
エンドポイントは仮のものですが､ `POST /api/v1alpha1/applications/{application_id}/secrets` のような形で受け取ります｡

POSTリクエストを受け取ったとき､APIサーバはクラスタに Secret リソースを作成します｡
Secretは自動でアプリケーションに対して注入されます｡
ファイルでのマウント､環境変数での注入は選択可能とします｡

### TACOKUMOリソース

TACOKUMOでは将来的に､PostgreSQLなどのマネージドサービスを提供することを想定しています｡
これらの接続情報は自動的にアプリケーションに渡されます｡

